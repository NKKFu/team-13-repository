<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAUDE 092 | Pré-Consulta</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <link rel="icon" href="./logo.png" title="saude092">

    <script src="./scripts/ubs-list.js"></script>
    <script src="./scripts/need-help.js"></script>

    <!-- Socket.io for communication between user and moderator -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
</head>

<body>
    <div class="w-100 shadow-sm py-3 bg-white" style="z-index: 10; height: 65px; position: fixed; top: 0px;">
        <div class="text-center">
            <h4 class="font-weight-bold text-primary">PRÉ-CONSULTA</h2>
        </div>
    </div>

    <a href="./index.html">
        <img src="./left-arrow.png" width="30" height="30" alt=""
            style="cursor: pointer; position: fixed; z-index: 15; top: 18px; left: 18px;">
    </a>

    <div style="margin-top: 100px;">

    </div>

    <div class="mx-auto my-5" style="min-height: 90vh;">
        <div class="mx-auto w-100" style="color: white; max-width: 1000px;">
            <div style="background-color: #2196F3;" class="rounded-top step-by-step">
                <div id="form-title0" class="w-25 text-center flex-fill title-active p-3">
                    <h4>Passo 1</h4>
                </div>
                <div id="form-title1" class="form-title w-25 text-center flex-fill p-3">
                    <h4>Passo 2</h4>
                </div>
                <div id="form-title2" class="form-title w-25 text-center flex-fill p-3">
                    <h4>Passo 3</h4>
                </div>
            </div>
            <div style="background-color: rgb(24, 163, 0);" class="rounded-bottom content pb-5">
                <div class="pb-3" id="form0">
                    <h2>Dados Pessoais</h2>
                    <form>
                        <div class="form-group">
                            <label for="exampleInputEmail1">Nome*</label>
                            <input type="text" class="form-control" id="name-input" aria-describedby="emailHelp"
                                placeholder="Insira seu nome">
                        </div>
                        <div class="form-group">
                            <label for="exampleInputPassword1">Telefone*</label>
                            <input type="number" class="form-control" id="number-input"
                                placeholder="Insira seu número de telefone">
                        </div>
                        <div class="form-group">
                            <label for="exampleInputPassword1">Idade*</label>
                            <input type="number" class="form-control" id="age-input" placeholder="Insira sua idade">
                        </div>
                    </form>
                    <h2>Grupo de Risco</h2>
                    <form>
                        <h5 class="m-0" for="inputPassword4">Informe para a gente se você se encaixa em um desses
                            grupos.</h5>
                        <small id="passwordHelpBlock" class="mt-0 mb-0 form-text">
                            Clique nos botões a seguir para especificar o tempo
                        </small>
                        <div class="container p-0">
                            <div class="row">
                                <div class="col-4">
                                    <label class="m-0 p-0 container">
                                        <input class="mark-button" name="group" value="60 anos" type="checkbox">
                                        <div class="p-3 rounded checkmark" style="width: 100%;">Idosos (tenho mais de 60
                                            anos)</div>
                                    </label>

                                </div>
                                <div class="col-4">
                                    <label class="p-0 container">
                                        <input class="mark-button" name="group" value="Asmatico" type="checkbox">
                                        <div class="p-3 rounded checkmark" style="width: 100%;">Asmáticos</div>
                                    </label>
                                </div>
                                <div class="col-4">
                                    <label class="p-0 container">
                                        <input class="mark-button" name="group" value="Diabetico" type="checkbox">
                                        <div class="p-3 rounded checkmark" style="width: 100%">Diabéticos</div>
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-4">
                                    <label class="m-0 p-0 container">
                                        <input class="mark-button" name="group" value="Fumante" type="checkbox">
                                        <div class="p-3 rounded checkmark" style="width: 100%;">Fumante</div>
                                    </label>

                                </div>
                                <div class="col-4">
                                    <label class="p-0 container">
                                        <input class="mark-button" name="group" value="Hipertensos" type="checkbox">
                                        <div class="p-3 rounded checkmark" style="width: 100%;">Hipertensos</div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </form>

                    <button onclick="nextForm()" type="button" class="btn btn-primary float-right px-5">Próximo</button>
                </div>
                <div class="pb-3 d-none" id="form1">
                    <h2>O que você está sentido?</h2>
                    <form>

                        <h5 class="m-0" for="inputPassword4">Informe os sintomas que você está sentindo no momento</h5>
                        <small id="passwordHelpBlock" class="mt-0 mb-0 form-text">
                            Clique nos botões a seguir para especificar seus sintomas.
                        </small>
                        <div class="container mb-5 p-0">
                            <div class="row">
                                <div class="col-6">
                                    <label class="m-0 p-0 container">
                                        <input class="mark-button" name="mark" value="Coriza" type="checkbox">
                                        <div class="p-3 rounded checkmark" style="width: 100%;">Coriza</div>
                                    </label>

                                </div>
                                <div class="col-6">
                                    <label class="p-0 container">
                                        <input class="mark-button" name="mark" value="Nariz entupido" type="checkbox">
                                        <div class="p-3 rounded checkmark" style="width: 100%;">Nariz entupido</div>
                                    </label>

                                </div>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <label class="p-0 container">
                                        <input class="mark-button" name="mark" value="Cansaço" type="checkbox">
                                        <div class="p-3 rounded checkmark" style="width: 100%;">Cansaço</div>
                                    </label>

                                </div>
                                <div class="col-6">
                                    <label class="p-0 container">
                                        <input class="mark-button" name="mark" value="Tosse" type="checkbox">
                                        <div class="p-3 rounded checkmark" style="width: 100%">Tosse</div>
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <label class="p-0 container">
                                        <input class="mark-button" name="mark" value="Dor de cabeça" type="checkbox">
                                        <div class="p-3 rounded checkmark" style="width: 100%;">Dor de cabeça</div>
                                    </label>

                                </div>
                                <div class="col-6">
                                    <label class="p-0 container">
                                        <input class="mark-button" name="mark" value="Dores no corpo ou mal estar"
                                            type="checkbox">
                                        <div class="p-3 rounded checkmark" style="width: 100%">Dores no corpo ou mal
                                            estar</div>
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <label class="p-0 container">
                                        <input class="mark-button" name="mark" value="Dor de garganta" type="checkbox">
                                        <div class="p-3 rounded checkmark" style="width: 100%;">Dor de garganta</div>
                                    </label>

                                </div>
                                <div class="col-6">
                                    <label class="p-0 container">
                                        <input class="mark-button" name="mark" value="Diarreia ou dores abdominais"
                                            type="checkbox">
                                        <div class="p-3 rounded checkmark" style="width: 100%">Diarreia ou dores
                                            abdominais</div>
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <label class="p-0 container">
                                        <input class="mark-button" name="mark" value="Perda de olfato" type="checkbox">
                                        <div class="p-3 rounded checkmark" style="width: 100%;">Perda de olfato (não
                                            sentir cheiro)</div>
                                    </label>

                                </div>
                                <div class="col-6">
                                    <label class="p-0 container">
                                        <input class="mark-button" name="mark" value="Perda do paladar" type="checkbox">
                                        <div class="p-3 rounded checkmark" style="width: 100%">Perda do paladar (não
                                            sentir gosto)</div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <h5 class="m-0" for="inputPassword4">Você está sentido febre?</h5>
                        <small id="passwordHelpBlock" class="mt-0 mb-0 form-text">
                            Clique nos botões a seguir para especificar o tempo
                        </small>
                        <div class="container p-0">
                            <div class="row">
                                <div class="col-6">
                                    <label class="m-0 p-0 container">
                                        <input class="mark-button" name="fever" value="Não, não estou sentido febre"
                                            type="radio">
                                        <div class="p-3 rounded checkmark" style="width: 100%;">Não, não estou sentido
                                            febre
                                        </div>
                                    </label>

                                </div>
                                <div class="col-6">
                                    <label class="p-0 container">
                                        <input class="mark-button" name="fever" value="Sim, à 2 dias" type="radio">
                                        <div class="p-3 rounded checkmark" style="width: 100%;">Sim, à 2 dias
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-6">
                                    <label class="m-0 p-0 container">
                                        <input class="mark-button" name="fever" value="Sim, entre 2 à 4 dias"
                                            type="radio">
                                        <div class="p-3 rounded checkmark" style="width: 100%;">Sim, entre 2 à 4 dias
                                        </div>
                                    </label>

                                </div>
                                <div class="col-6">
                                    <label class="p-0 container">
                                        <input class="mark-button" name="fever" value="Sim, à mais de 4 dias"
                                            type="radio">
                                        <div class="p-3 rounded checkmark" style="width: 100%;">Sim, à mais de 4 dias
                                            atrás.
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <h5 class="m-0" for="inputPassword4">Você está sentido falta de ar?</h5>
                        <small id="passwordHelpBlock" class="mt-0 mb-0 form-text">
                            Clique nos botões a seguir para especificar o tempo
                        </small>
                        <div class="container p-0">
                            <div class="row">
                                <div class="col-6">
                                    <label class="m-0 p-0 container">
                                        <input class="mark-button" name="air" value="Não, não estou sentido falta de ar"
                                            type="radio">
                                        <div class="p-3 rounded checkmark" style="width: 100%;">Não, não estou sentido
                                            falta de ar
                                        </div>
                                    </label>

                                </div>
                                <div class="col-6">
                                    <label class="p-0 container">
                                        <input class="mark-button" name="air" value="Sim, à 2 dias" type="radio">
                                        <div class="p-3 rounded checkmark" style="width: 100%;">Sim, à 2 dias
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-6">
                                    <label class="m-0 p-0 container">
                                        <input class="mark-button" name="air" value="Sim, entre 2 à 4 dias"
                                            type="radio">
                                        <div class="p-3 rounded checkmark" style="width: 100%;">Sim, entre 2 à 4 dias
                                        </div>
                                    </label>

                                </div>
                                <div class="col-6">
                                    <label class="p-0 container">
                                        <input class="mark-button" name="air" value="Sim, à mais de 4 dias"
                                            type="radio">
                                        <div class="p-3 rounded checkmark" style="width: 100%;">Sim, à mais de 4 dias
                                            atrás.
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <button onclick="backForm()" type="button" class="btn btn-danger float-left">Voltar</button>
                        <button onclick="nextForm()" type="button" class="btn btn-primary float-right">Próximo</button>
                    </form>
                </div>
                <div class="pb-3 d-none" id="form2">
                    <div id="end1" class="d-none">
                        <h2>Instruções</h2>
                        <h5>Lave as mãos com água e sabão por pelo menos 20 segundos, com frequência. Quando não for
                            possível, limpe e higienize suas mãos com álcool gel 70%; - Evite encostar as mãos não
                            lavadas nos olhos, boca e nariz;
                            - Quando tossir e espirrar, cubra a boca e o nariz com um lenço de papel descartável e
                            jogue-o no lixo, ou proteja com o antebraço. Não use suas mãos, a fim de evitar transmitir o
                            vírus para objetos e pessoas;
                            - Evite locais muito cheios e com aglomeração de pessoas (shows, festas, shoppings etc);
                            - Não compartilhe objetos de uso pessoal, como copos, talheres e pratos, e limpe objetos que
                            sejam tocados com frequência, como celulares; - Evite contato próximo com pessoas que
                            estejam com sintomas de resfriado ou gripe.
                            - Se você tem mais de 60 anos ou já possui uma doença crônica, como diabetes, pressão
                            arterial elevada, doença renal, cardíaca ou respiratória, está em tratamento oncológico ou
                            com medicamentos que afetem a imunidade, fique ainda mais atento aos sintomas e procure seu
                            médico se apresentar sinais de descompensação!/h5>
                    </div>
                    <div id="end2" class="d-none">
                        <h2>Encaminhamento</h2>
                        <h5>Para podermos encaminhar você à uma unidade médica</h5>
                    </div>
                    <div id="end3" class="d-none">
                        <h2>Fale com um de nossos atendentes</h2>
                        <h6>Nossa inteligência artifical não conseguiu proceder corretamente. Vamos falar com você pelo
                            bate-papo abaixo. (Espere algum atendente entrar em contato com você)</h6>

                        <div id="chat-history" style="height: 400px; color: black; overflow:scroll;"
                            class="p-3 bg-light rounded-top">
                            <div class="p-3 rounded mb-3 shadow-sm" style="width: 80%; background-color: #fff">
                                <h5>Olá, como posso ajudar?
                                </h5>
                            </div>
                        </div>
                        <script>
                            const div = document.getElementById("chat-history");
                            div.scrollTop = div.scrollHeight;

                            let socket, roomID;

                            function ConnectToServer() {
                                socket = io('https://chat-saude092.herokuapp.com/');
                                socket.on('connect', function (data) {
                                    socket.emit('JoinRoom');
                                });

                                socket.on('connectToRoom', function (data) {
                                    console.log('My room ID is ' + data);
                                    alert('Você está na sala ' + roomID)
                                    roomID = data;
                                });

                                socket.on('message', function (author, msg) {
                                    if (msg.length < 1)
                                        return;

                                    const cardHolder = document.createElement('div');

                                    const messageCard = document.createElement('div');
                                    messageCard.classList.add("p-3", "rounded", "my-3", "shadow-sm");
                                    messageCard.style = "width: 80%; background-color: #fff";

                                    const messageContent = document.createElement('h5');
                                    messageContent.innerHTML = msg;
                                    messageCard.appendChild(messageContent);

                                    cardHolder.appendChild(messageCard);

                                    document.getElementById('chat-history').appendChild(cardHolder);

                                    const div = document.getElementById("chat-history");
                                    div.scrollTop = div.scrollHeight;
                                });
                            }

                            function sendMessage() {
                                if (!roomID)
                                    return;

                                const cardHolder = document.createElement('div');

                                const msgValue = document.getElementById('chat-input').value;
                                document.getElementById('chat-input').value = "";

                                socket.emit('messageToServer', 'SAUDE', roomID, msgValue);

                                const messageCard = document.createElement('div');
                                messageCard.classList.add("p-3", "rounded", "my-3", "shadow-sm");
                                messageCard.style = "margin-left:20%; width: 80%; background-color: rgb(231, 231, 231)";

                                const messageContent = document.createElement('h5');
                                messageContent.innerHTML = msgValue;
                                messageCard.appendChild(messageContent);

                                cardHolder.appendChild(messageCard);

                                document.getElementById('chat-history').appendChild(cardHolder);

                                const div = document.getElementById("chat-history");
                                div.scrollTop = div.scrollHeight;
                            }
                        </script>
                        <div class="d-flex">
                            <input id="chat-input" class="form-control form-control-lg"
                                style="height: 60px; border-radius: 0;" type="text" placeholder="Digite algo..">

                            <button onclick="sendMessage()" type="button" style="height: 60px; border-radius: 0;"
                                class="px-5 py-3 btn btn-primary">ENVIAR</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            let formCounter = 0;

            function backForm() {
                if (formCounter > 0) {
                    // Elemento atual
                    const currentForm = document.getElementById('form' + formCounter);
                    currentForm.classList.add('d-none');

                    const nextForm = document.getElementById('form' + (formCounter - 1));
                    nextForm.classList.remove('d-none');

                    // Próximo elemento
                    const nextFormTitle = document.getElementById('form-title' + (formCounter))
                    nextFormTitle.classList.add('form-title');
                    nextFormTitle.classList.remove('title-active');
                    formCounter--;
                }
            }

            function nextForm() {
                const name = document.getElementById('name-input').value;
                const number = document.getElementById('number-input').value;
                const age = document.getElementById('age-input').value;

                const groupRiskInput = document.querySelector("input[name=group]:checked");
                const groupRisk = groupRiskInput ? groupRiskInput.value : "";

                const marksInput = Array.prototype.slice.call(document.getElementsByName('mark')).filter(value => {
                    return value.checked;
                }).map(element => {
                    return element = element.value;
                });
                const marks = marksInput;

                const feverInput = document.querySelector("input[name=fever]:checked");
                const fever = feverInput ? feverInput.value : "";

                const airInput = document.querySelector("input[name=air]:checked");
                const air = airInput ? airInput.value : "";

                switch (formCounter) {
                    case 0:
                        if (name === '' || number === '' || age === '') {
                            alert('Preencha todos os campos obrigatórios');
                            return;
                        }

                        console.log(name, number, age, groupRisk);
                        break;
                    case 1:
                        console.log(marks, fever, air);
                        break;
                }

                if (formCounter < 2) {
                    // Elemento atual
                    const currentForm = document.getElementById('form' + formCounter);
                    currentForm.classList.add('d-none');

                    const nextForm = document.getElementById('form' + (formCounter + 1));
                    nextForm.classList.remove('d-none');

                    // Próximo elemento
                    const nextFormTitle = document.getElementById('form-title' + (formCounter + 1))
                    nextFormTitle.classList.remove('form-title');
                    nextFormTitle.classList.add('title-active');
                    formCounter++;
                }

                if (formCounter == 2) {
                    const currentCase = 1;
                    switch (currentCase) {
                        case 1:
                            sendEmail(name, age, groupRisk, marks, number);
                            break;
                        case 2:
                            ConnectToServer();
                            break;
                    }
                    document.getElementById('end3').classList.remove('d-none');
                }
            }

            function sendEmail(name, age, group, marks, number) {
                const Http = new XMLHttpRequest();
                Http.open("POST", 'https://saude-092.herokuapp.com/patient/new');
                Http.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
                Http.send(JSON.stringify({
                    name,
                    age,
                    isGroup: group,
                    marks,
                    contact: number,
                }));

                Http.onreadystatechange = (e) => {
                    console.log(Http.responseText)
                }
            }
        </script>

        <style>
            .step-by-step {
                display: flex;
                justify-content: space-between;
            }

            .content {
                padding: 3vh;
            }

            .title-active {
                background-color: rgb(24, 163, 0);
            }

            .form-title {
                color: white;
            }
        </style>

        <div id="register-info" style="animation-name: fadeIn; animation-duration: 2s;" class="d-none">

            <h5 class="text-sucess text-center">
                Seu cadastro foi realizado com sucesso! A unidade de saúde com menor pico de atendimento que está mais
                próxima a você é:
            </h5>

            <div id="UBS-card" class=" card w-100">
                <div class="card-body">
                    <h5 id="UBS-name" class="card-title">Nome da UBS</h5>
                    <h6 id="UBS-street" class="card-subtitle mb-2 text-muted">Rua da UBS</h6>
                    <p class="card-text">Utilizamos sua localização aproximada, portanto a unidade médica mais próxima
                        de você pode não ser esta. <br><b>Número de vagas: 204</b><br><b>Tempo médio de atendimento: 23m
                            0s</b></p>
                    <a id="UBS-maps" href="#" class="card-link">Abrir no Google Maps</a>
                </div>
            </div>
        </div>

        <div id="risk-group-info" class="d-none">
            <div class="card-body">
                <h3 id="" class="text-center text-danger card-title">Você faz parte do grupo de risco</h3>
                <h6 id="" class="card-subtitle mb-2 text-muted">Portanto seu código de cadastro é gerado imediatamente:
                    23874218374982
                </h6>
                <h4 class="card-text">Instruções de atendimento:<br>
                    <h6>
                        <b>- NÃO ATUALIZE ESTA PÁGINA</b><br>
                        <b>- Fique atento ao seu celular, mandaremos uma mensagem por lá.</b><br>
                        <b>- Espere surgir uma nova instrução.</b>
                    </h6>
                </h4>
            </div>
        </div>
    </div>

    <style>
        @keyframes fadeIn {
            0% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }

        .custom-shadow {
            box-shadow: 0px 0px 20px -2px #dddddd;
        }

        ::-webkit-scrollbar {
            display: none;
        }

        .special-background {
            background-image: url("./home-assets/background.png");
            background-repeat: no-repeat;
            background-position: 90vh 80px;
        }

        body {
            animation-name: fadeIn;
            animation-duration: 2s;
            background: linear-gradient(to bottom, #fff 0%, #fff 80%, rgba(246, 246, 246, 1) 85%, #fee6e5 100%);
        }

        html {
            scroll-behavior: smooth;
        }

        #hamburguer {
            display: none;
        }

        .nav-options {
            display: flex;
            flex-direction: row;
        }

        .nav-options a h4 {
            margin-bottom: 0;
        }

        .not-active {
            padding-top: 0.3rem;
        }

        @media screen and (max-width: 768px) {
            .nav-options {
                transition: all 0.3s;
                position: absolute;
                right: 0;
                height: 92vh;
                width: 70%;
                background-color: rgba(240, 240, 240, 0.924);
                flex-direction: column;
                align-items: center;
                transform: translateX(100%);
            }

            .nav-options a {
                margin-top: 40px;
            }

            #hamburguer {
                display: inline;
            }
        }

        .need-help-button:hover {
            background-color: rgb(255, 234, 235);
        }

        .nav-active {
            transform: translateX(0%);
        }

        .container .mark-button {
            height: 0;
        }

        .container .mark-button:checked~.checkmark {
            background-color: #2196F3;
            color: white;
        }

        .container .mark-button~.checkmark {
            background-color: rgb(228, 243, 255);
            color: rgb(12, 90, 114);
        }
    </style>

</body>

</html>